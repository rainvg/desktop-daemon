var path=require("path"),electron=require("electron"),pkg=require("../package.json");electron.dialog.showErrorBox=function(e,o){console.log("[ErrorBox",e,"-",o,"]")};var _appIcon,_windows={};module.exports=function(e){electron.app.on("window-all-closed",function(){"darwin"===process.platform&&electron.app.dock.hide()}),electron.app.on("will-quit",function(e){e.preventDefault(),"darwin"===process.platform&&electron.app.dock.hide()}),_appIcon=new electron.Tray(path.resolve(__dirname,"..","resources","logo@5x.png"));var o=electron.Menu.buildFromTemplate([{label:"Daemon v. "+pkg.version},{label:"Desktop v. "+e.version.main},{type:"separator"},{label:"Send a report",click:function(){_windows.report=new electron.BrowserWindow({title:"Rain - Send a report!",width:700,height:"win32"===process.platform?650:600,resizable:!1,center:!0,titleBarStyle:"hidden-inset"}),_windows.report.loadURL("file://"+path.resolve(__dirname,"..","resources","report.html")),_windows.report.on("closed",function(){delete _windows.report})}},{label:"Check for update",click:function(){global.desktop_version=e.version.main,_windows.update=new electron.BrowserWindow({title:"Rain - Update Available!",width:690,height:"win32"===process.platform?530:480,resizable:!1,center:!0,titleBarStyle:"hidden-inset"}),_windows.update.loadURL("file://"+path.resolve(__dirname,"..","resources","update.html")),_windows.update.on("closed",function(){delete _windows.update})}},{type:"separator"},{label:"‚ù§ for con-tree-buting!"},{type:"separator"},{label:"Quit",click:function(){e.shutdown().then(function(){console.log("Shutting down, goodbye.");for(var e in _windows)_windows[e].close();electron.app.exit(0)})}}]);_appIcon.setToolTip("Rain"),_appIcon.setContextMenu(o)};
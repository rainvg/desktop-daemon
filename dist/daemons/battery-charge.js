var child_process=require("child_process"),os=require("os"),nappy=require("nappy"),fs=require("fs-extra"),settings={interval:3e4},_events,_analytics,charge=function(){return"darwin"===os.platform()?new Promise(function(e,t){_analytics.client.event("battery-charge","try").send(),child_process.exec("system_profiler SPPowerDataType",function(r,s){var n=s.toString();if(r)return void t();try{var a=parseInt(/\d+/.exec(/\s*Charge\ Remaining\ \(mAh\):\s*\d+/.exec(n)[0])[0],10),c=parseInt(/\d+/.exec(/\s*Voltage\ \(mV\):\s*\d+/.exec(n)[0])[0]),i=/\s*Charging:\sNo/.test(n);i?e(a*c/1e6):t()}catch(o){t()}})}):"win32"===os.platform()&&os.release().split(".")[0]>6||6===os.release().split(".")[0]&&os.release().split(".")[1]>=2?new Promise(function(e,t){child_process.exec("cd "+os.tmpdir()+" & powercfg /batteryreport",function(r,s){var n=s.toString();if(r)return void t();try{var a=/C:.*html/.exec(n)[0],c=/Report\ generated[\s\S]*?mWh/.exec(fs.readFileSync(a).toString())[0],i=parseInt(/\d+/.exec(/mw[\s\S]*\d+/.exec(c)[0])[0]),o=/Battery/.test(c);o?e(i):t()}catch(_){t()}})}):Promise.reject()},__run__=function(){nappy.wait["for"](settings.interval).then(charge).then(function(e){_events.push({type:"battery-charge",data:{charge:e}}),_analytics.client.event("battery-charge","success").send(),__run__()})["catch"](__run__)};module.exports=function(e,t){_events=e,_analytics=t,__run__()};
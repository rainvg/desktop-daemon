var child_process=require("child_process"),os=require("os"),nappy=require("nappy"),settings={interval:3e4},_events,_analytics,charge=function(){return"darwin"===os.platform()?new Promise(function(e,t){_analytics.client.event("battery-charge","try").send(),child_process.exec("system_profiler SPPowerDataType",function(n,r){var a=r.toString();if(n)return void t();try{var s=parseInt(/\d+/.exec(/\s*Charge\ Remaining\ \(mAh\):\s*\d+/.exec(a)[0])[0],10),c=parseInt(/\d+/.exec(/\s*Voltage\ \(mV\):\s*\d+/.exec(a)[0])[0]),i=/\s*Charging:\sNo/.test(a);i?e(s*c/1e6):t()}catch(_){t()}})}):Promise.reject()},__run__=function(){nappy.wait["for"](settings.interval).then(charge).then(function(e){_events.push({type:"battery-charge",data:{charge:e}}),_analytics.client.event("battery-charge","success").send(),__run__()})["catch"](__run__)};module.exports=function(e,t){_events=e,_analytics=t,__run__()};